<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Webpage Extractor â€” API Ninjas</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>Webpage Extractor</h1>
      <p>Extract essential information from any webpage instantly</p>
    </header>

    <div class="content">
      <section class="input-section">
        <div class="input-group">
          <label for="urlInput">Website URL</label>
          <div class="input-wrapper">
            <span class="material-icons">language</span>
            <input id="urlInput" type="url" placeholder="https://example.com" value="https://utkarsh.info" />
          </div>
        </div>

        <div class="options">
          <div class="checkbox-wrapper">
            <input id="useProxy" type="checkbox" />
            <label for="useProxy">Use local proxy (recommended for production)</label>
          </div>
        </div>

        <div class="buttons">
          <button id="fetchBtn" class="btn btn-primary">
            <span class="material-icons">search</span>
            Extract Data
          </button>
          <button id="clearBtn" class="btn btn-secondary">
            <span class="material-icons">clear</span>
            Clear Results
          </button>
        </div>
      </section>

      <section class="output-section">
        <h2 class="section-title">
          <span class="material-icons">info</span>
          Extracted Information
        </h2>
        <div class="result-container">
          <div class="result-header">
            <span class="material-icons">data_object</span>
            Webpage Details
          </div>
          <div id="resultArea" class="result-content">
            <div class="loading">
              <div class="material-icons">hourglass_empty</div>
              <p>Ready to extract webpage data</p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // script.js
    const fetchBtn = document.getElementById('fetchBtn');
    const clearBtn = document.getElementById('clearBtn');
    const urlInput = document.getElementById('urlInput');
    const resultArea = document.getElementById('resultArea');
    const useProxy = document.getElementById('useProxy');

    function showLoading() {
      resultArea.innerHTML = `
        <div class="loading">
          <div class="material-icons">sync</div>
          <p>Extracting webpage data...</p>
        </div>
      `;
    }

    function showError(message) {
      resultArea.innerHTML = `
        <div class="error">
          <span class="material-icons">error</span>
          <div>
            <strong>Error:</strong> ${message}
          </div>
        </div>
      `;
    }

    function showResults(data) {
      const favicon = data.favicon ? 
        `<img src="${data.favicon}" alt="Favicon" class="favicon" onerror="this.style.display='none'">` :
        `<div class="favicon-placeholder"><span class="material-icons">web</span></div>`;

      resultArea.innerHTML = `
        <div class="result-item">
          <span class="material-icons result-icon">title</span>
          <div class="result-info">
            <div class="result-label">Page Title</div>
            <div class="result-value ${!data.page_title ? 'empty' : ''}">${data.page_title || 'No title found'}</div>
          </div>
        </div>
        <div class="result-item">
          <span class="material-icons result-icon">description</span>
          <div class="result-info">
            <div class="result-label">Description</div>
            <div class="result-value ${!data.page_description ? 'empty' : ''}">${data.page_description || 'No description found'}</div>
          </div>
        </div>
        <div class="result-item">
          <span class="material-icons result-icon">link</span>
          <div class="result-info">
            <div class="result-label">URL</div>
            <div class="result-value">${data.url || 'N/A'}</div>
          </div>
        </div>
        <div class="result-item">
          <span class="material-icons result-icon">public</span>
          <div class="result-info">
            <div class="result-label">Domain</div>
            <div class="result-value">${data.domain || 'N/A'}</div>
          </div>
        </div>
        <div class="result-item">
          <span class="material-icons result-icon">image</span>
          <div class="result-info">
            <div class="result-label">Favicon</div>
            <div class="result-value" style="display: flex; align-items: center; gap: 12px;">
              ${favicon}
              <span class="${!data.favicon ? 'empty' : ''}">${data.favicon || 'No favicon found'}</span>
            </div>
          </div>
        </div>
      `;
    }

    fetchBtn.addEventListener('click', async () => {
      const targetUrl = urlInput.value.trim();
      if (!targetUrl) {
        showError('Please enter a valid URL');
        return;
      }

      // Disable button during fetch
      fetchBtn.disabled = true;
      fetchBtn.innerHTML = '<span class="material-icons">hourglass_empty</span> Extracting...';
      
      showLoading();

      try {
        let response;
        
        if (useProxy.checked) {
          response = await fetch(`/proxy?url=${encodeURIComponent(targetUrl)}`);
          if (!response.ok) throw new Error(`Proxy error: ${response.status} ${response.statusText}`);
        } else {
          // Direct API call (for testing only)
          const API_KEY = "tmzQqPk8v0EuGfP1d7pWBw==sTExHT0IOuEvNul1";
          const apiUrl = `https://api.api-ninjas.com/v1/webpage?url=${encodeURIComponent(targetUrl)}`;

          response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
              'X-Api-Key': API_KEY,
              'Accept': 'application/json'
            }
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`API Error (${response.status}): ${errorText}`);
          }
        }

        const data = await response.json();
        showResults(data);

      } catch (err) {
        console.error(err);
        showError(err.message);
      } finally {
        // Re-enable button
        fetchBtn.disabled = false;
        fetchBtn.innerHTML = '<span class="material-icons">search</span> Extract Data';
      }
    });

    clearBtn.addEventListener('click', () => {
      resultArea.innerHTML = `
        <div class="loading">
          <div class="material-icons">hourglass_empty</div>
          <p>Ready to extract webpage data</p>
        </div>
      `;
    });

    // Allow Enter key to trigger fetch
    urlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        fetchBtn.click();
      }
    });
  </script>
</body>
</html>